# Creates image for gradle test execution, contains veo-history sources.
FROM gradle:jdk11

# Copy gradle files only and pull dependencies. The actual gradle build will fail because there are no sources, but
# we just want to pull dependencies, so we'll return 0. This allows docker layer caching so we don't have to download
# the dependencies every time.
COPY --chown=gradle:gradle build.gradle.kts settings.gradle.kts /home/gradle/veo-history/
WORKDIR /home/gradle/veo-history
RUN gradle build || return 0

# Copy veo-history sources and run bash so gradle test can be run inside this container with any args.
COPY --chown=gradle:gradle . /home/gradle/veo-history
RUN bash

